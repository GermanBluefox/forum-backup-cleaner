{"version":3,"file":"index.js","sourceRoot":"","sources":["../src/index.ts"],"names":[],"mappings":";;AAAA,sCAAsC;AACtC,qCAAsC;AAEtC,SAAS,OAAO,CAAC,IAAY;IACzB,yBAAyB;IACzB,MAAM,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;IAC9B,IAAI,KAAK,CAAC,MAAM,IAAI,CAAC,EAAE,CAAC;QACpB,MAAM,GAAG,GAAG,IAAI,GAAG,QAAQ,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC;QAC1C,MAAM,KAAK,GAAG,QAAQ,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,GAAG,CAAC,CAAC;QACzC,MAAM,IAAI,GAAG,QAAQ,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC;QAClD,OAAO,IAAI,IAAI,CAAC,IAAI,EAAE,KAAK,EAAE,GAAG,CAAC,CAAC;IACtC,CAAC;IACD,OAAO,IAAI,CAAC;AAChB,CAAC;AAED,MAAM,IAAI,GAAG,IAAA,qBAAW,EAAC,SAAS,CAAC,CAAC;AACpC,MAAM,GAAG,GAAG,IAAI,IAAI,EAAE,CAAC;AACvB,uCAAuC;AACvC,KAAK,MAAM,IAAI,IAAI,IAAI,EAAE,CAAC;IACtB,MAAM,IAAI,GAAG,OAAO,CAAC,IAAI,CAAC,CAAC;IAC3B,IAAI,IAAI,EAAE,CAAC;QACP,MAAM,IAAI,GAAG,GAAG,CAAC,OAAO,EAAE,GAAG,IAAI,CAAC,OAAO,EAAE,CAAC;QAC5C,MAAM,IAAI,GAAG,IAAI,GAAG,CAAC,IAAI,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,CAAC,CAAC;QAC1C,IAAI,IAAI,GAAG,EAAE,EAAE,CAAC;YACZ,OAAO,CAAC,GAAG,CAAC,yBAAyB,IAAI,UAAU,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,iBAAiB,IAAI,CAAC,WAAW,EAAE,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;YACzH,uDAAuD;YACvD,oCAAoC;QACxC,CAAC;IACL,CAAC;AACL,CAAC","sourcesContent":["// Read all files in directory /backup\r\nimport { readdirSync } from 'node:fs';\r\n\r\nfunction getDate(name: string): Date | null {\r\n    // nodebb-25-10-22.tar.gz\r\n    const parts = name.split('-');\r\n    if (parts.length >= 4) {\r\n        const day = 2000 + parseInt(parts[1], 10);\r\n        const month = parseInt(parts[2], 10) - 1;\r\n        const year = parseInt(parts[3].split('.')[0], 10);\r\n        return new Date(year, month, day);\r\n    }\r\n    return null;\r\n}\r\n\r\nconst list = readdirSync('/backup');\r\nconst now = new Date();\r\n// delete all backups oder than 30 days\r\nfor (const file of list) {\r\n    const date = getDate(file);\r\n    if (date) {\r\n        const diff = now.getTime() - date.getTime();\r\n        const days = diff / (1000 * 60 * 60 * 24);\r\n        if (days > 30) {\r\n            console.log(`Deleting backup file: ${file} (age: ${Math.floor(days)} days) (date: ${date.toISOString().split('T')[0]})`);\r\n            // uncomment the next line to actually delete the files\r\n            // fs.unlinkSync(`/backup/${file}`);\r\n        }\r\n    }\r\n}"]}